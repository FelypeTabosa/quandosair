<!DOCTYPE html>
<html>
<head>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.7/angular.min.js"></script>
	<script type="text/javascript">
		var app = angular.module('minhaCalculadoraDeHoras', []);
		app.controller('CalculadoraDeHora', function($scope, $http) {
			//inicializa hora e dados
			$scope.hora = {
				"horasParaTrabalhar":0,
				"minutosParaTrabalhar":0,
				"horaDeEntrada":0,
				"minutosDeEntrada":0,
				"horaDeSaidaAlmoco":0,
				"minutosDeSaidaAlmoco":0,
				"horaDeChegadaAlmoco":0,
				"minutosDeChegadaAlmoco":0
			};
			$scope.hasAlmoco = true;
			angular.element('.error').hide();
			
			angular.element('.div-box-button').mouseenter(function(){
				$scope.verificaCamposEntradaHorasTrabalhadas();
			});
			
			//função que valida os campos do formulário
			$scope.verificaCamposEntradaHorasTrabalhadas = function(){
				var horasTrabalhadas = angular.element("#horasParaTrabalhar").val();
				var horasEntrada = angular.element("#horaDeEntrada").val();
				if(horasTrabalhadas == "" || horasEntrada == ""){
					if(horasTrabalhadas == ""){
						$scope.marcaInvalido('#horasParaTrabalhar',"Informe as horas necessarias");
					}else{
						angular.element('#horasParaTrabalhar').removeClass('invalid');
					}
					if(horasEntrada == ""){
						$scope.marcaInvalido('#horaDeEntrada',"Informe as horas necessarias");
					}else{
						angular.element('#horaDeEntrada').removeClass('invalid');
					}
				}else if(!horasTrabalhadas.includes(":") || !horasEntrada.includes(":")){
					if(!horasTrabalhadas.includes(":")){
						$scope.marcaInvalido('#horasParaTrabalhar',"Precisa informar o separador ' : '");
					}else{
						angular.element('#horasParaTrabalhar').removeClass('invalid');
					}
					if(!horasEntrada.includes(":")){
						$scope.marcaInvalido('#horaDeEntrada',"Precisa informar o separador ' : '");
					}else{
						angular.element('#horaDeEntrada').removeClass('invalid');
					}
				}else{
					$scope.lerCampos();
					if($scope.validaInputHorasParaTrabalhar()){
						$scope.marcaInvalido('#horasParaTrabalhar','Informe horas validas | Formato: HH:MM');
					}else{
						angular.element('#horasParaTrabalhar').removeClass('invalid');
					}
					if($scope.validaInputHoraDeEntrada()){
						$scope.marcaInvalido('#horaDeEntrada','Informe horas validas | Formato: HH:MM');
					}else{
						angular.element('#horaDeEntrada').removeClass('invalid');
					}
					if(!$scope.validaInputHorasParaTrabalhar() && !$scope.validaInputHoraDeEntrada()){
						$scope.marcaValido();
					}
				}
			}
			
			$scope.marcaValido = function(){
				angular.element('#CalcularHora').attr('disabled',false);
				angular.element('.error').slideUp(1000);
				angular.element(':text').removeClass('invalid');
			}
			
			$scope.marcaInvalido = function(field, message){
				angular.element(field).addClass('invalid');
				angular.element('#CalcularHora').attr('disabled',true);
				angular.element('.error span').text(message);
				angular.element('.error').slideDown(1000);
			}
			
			$scope.validaInputHorasParaTrabalhar = function(){
				if($scope.hora.minutosParaTrabalhar > 60 || $scope.hora.minutosParaTrabalhar < 0 || $scope.hora.horasParaTrabalhar < 0
						|| ($scope.hora.horasParaTrabalhar >= 24 && $scope.hora.minutosParaTrabalhar > 0)
						|| (isNaN($scope.hora.horasParaTrabalhar) || isNaN($scope.hora.minutosParaTrabalhar))){
					return true;
				}
				return false;
			}
			
			$scope.validaInputHoraDeEntrada = function(){
				if($scope.hora.minutosDeEntrada > 60 || $scope.hora.minutosDeEntrada < 0 || $scope.hora.horaDeEntrada < 0
						|| ($scope.hora.horaDeEntrada >= 24 && $scope.hora.minutosDeEntrada > 0)
						|| (isNaN($scope.hora.horaDeEntrada) || isNaN($scope.hora.minutosDeEntrada))){
					return true;
				}
				return false;
			}
			
			//função que ler os campos do formulário
			$scope.lerCampos = function(){
				// Recupera valores de Horas da view
				var horasTrabalhadas = angular.element("#horasParaTrabalhar").val();
				var horasEntrada = angular.element("#horaDeEntrada").val();
				var horasSaidaAlmoco = angular.element("#horaDeSaidaAlmoco").val() != ""? angular.element("#horaDeSaidaAlmoco").val() : "0:00";
				var horasChegadaAlmoco = angular.element("#horaDeChegadaAlmoco").val() != ""? angular.element("#horaDeChegadaAlmoco").val() : "0:00";
				
				//Separadores das horas
				var indexHT = horasTrabalhadas.indexOf(":");
				var indexHE = horasEntrada.indexOf(":");
				var indexHSA = horasSaidaAlmoco.indexOf(":");
				var indexHCA = horasChegadaAlmoco.indexOf(":");
				
				//transforma horas recuperas da view em int
				$scope.hora.minutosParaTrabalhar = parseInt(horasTrabalhadas.slice(indexHT +1));
				$scope.hora.minutosDeEntrada = parseInt(horasEntrada.slice(indexHE +1));
				$scope.hora.minutosDeSaidaAlmoco = parseInt(horasSaidaAlmoco.slice(indexHSA +1));
				$scope.hora.minutosDeChegadaAlmoco = parseInt(horasChegadaAlmoco.slice(indexHCA +1));
				$scope.hora.horasParaTrabalhar = parseInt(horasTrabalhadas.slice(0,indexHT));
				$scope.hora.horaDeEntrada = parseInt(horasEntrada.slice(0,indexHE));
				$scope.hora.horaDeSaidaAlmoco = parseInt(horasSaidaAlmoco.slice(0,indexHSA));
				$scope.hora.horaDeChegadaAlmoco = parseInt(horasChegadaAlmoco.slice(0,indexHCA));
			}
			
			//Função Calcula hora
			$scope.CalcularHora = function(){
				angular.element('.display-none').removeClass('display-none');
				
				
				//Calcula Almoço
				$scope.hora.horaIntervaloAlmoco = 0;
				$scope.hora.minutosIntervaloAlmoco = 0;
				if( $scope.hasAlmoco == true){
					$scope.hora.horaIntervaloAlmoco = $scope.hora.horaDeChegadaAlmoco - $scope.hora.horaDeSaidaAlmoco;
					$scope.hora.minutosIntervaloAlmoco = $scope.hora.minutosDeChegadaAlmoco - $scope.hora.minutosDeSaidaAlmoco;
					if( $scope.hora.minutosIntervaloAlmoco >= 60){
						var dividendo = parseInt($scope.hora.minutosIntervaloAlmoco / 60); 
						var resto = $scope.hora.minutosIntervaloAlmoco % 60;
						$scope.hora.horaIntervaloAlmoco += dividendo;
						$scope.hora.minutosIntervaloAlmoco = resto;
					}
					$scope.hora.horaTrabalhadaParteOne = $scope.hora.horaDeSaidaAlmoco - $scope.hora.horaDeEntrada;
					$scope.hora.minutosTrabalhadosParteOne = $scope.hora.minutosDeSaidaAlmoco - $scope.hora.minutosDeEntrada;
					
					$scope.hora.horasParaTrabalhar -= $scope.hora.horaTrabalhadaParteOne;
					$scope.hora.minutosParaTrabalhar -= $scope.hora.minutosTrabalhadosParteOne;
					$scope.hora.horaDeEntrada = $scope.hora.horaDeChegadaAlmoco;
					$scope.hora.minutosDeEntrada = $scope.hora.minutosDeChegadaAlmoco;
				}
				
				
				$scope.hora.horaPrevistaDeSaida = $scope.hora.horaDeEntrada + $scope.hora.horasParaTrabalhar;
				$scope.hora.minutoPrevistoDeSaida = $scope.hora.minutosDeEntrada + $scope.hora.minutosParaTrabalhar;
				
				if( $scope.hora.minutoPrevistoDeSaida >= 60){
					var dividendo = parseInt($scope.hora.minutoPrevistoDeSaida / 60); 
					var resto = $scope.hora.minutoPrevistoDeSaida % 60;
					$scope.hora.horaPrevistaDeSaida += dividendo;
					$scope.hora.minutoPrevistoDeSaida = resto;
				}
				$scope.hora.horaPrevistaDeSaida = $scope.hora.horaPrevistaDeSaida < 10 ? "0"+$scope.hora.horaPrevistaDeSaida : $scope.hora.horaPrevistaDeSaida; 
				$scope.hora.minutoPrevistoDeSaida = $scope.hora.minutoPrevistoDeSaida < 10 ? "0"+$scope.hora.minutoPrevistoDeSaida : $scope.hora.minutoPrevistoDeSaida;
				$scope.tempoPrevistoDeSaida = $scope.hora.horaPrevistaDeSaida +":"+$scope.hora.minutoPrevistoDeSaida;
			}
			
		});
	</script>
	<style>
	.container{
		background-color: white;
		margin-top:-17px;
	}
	.container-box{
		display: block;
		width: 400px;
		margin: auto;
		margin-top:100px;
		text-align: center;
		border: 1px solid lightgrey;
		border-radius: 5px;
		padding: 5px 0px;
		background-color: lightseagreen;
	}
	.div-box-header{
		border:0;
		border-bottom: 1px solid lightgray;
		margin-bottom: 5px;
	}
	.div-box-footer{
		border:0;
		border-top: 1px solid lightgray;
		margin-top: 5px;
	}
	.div-box-hora-entrada{
		margin-top: 10px;
	}
	.div-box-button{
		background-color: lightseagreen;
	}
	.input-box{
		display: block;
		width: 50%;
		text-align: center;
		font-size: 15px;
		border: 0px;
		padding: 10px;
		margin: auto;
		border-radius: 10px;
		box-shadow: 0px 0px 6px seagreen;
	}
	.button-box{
		display: block;
		width: 15%;
		margin: auto;
		padding: 10px 0px;
		font-size: 15px;
		font-weight: bold;
		background-color: lightseagreen;
		border-radius: 10px;
		color: white;
		border: 0px;
		cursor: pointer;
	}
	.h1-box{
		width: 30%;
		border-radius: 10px;
		color: white;
		box-shadow: 0px 0px 3px darkgrey;
		padding: 5px;
		background-color: darkseagreen;
		margin: auto;
	}
	h3{
		color: seagreen;
	}
	.display-none{
		display: none;
	}
	.error{
		background-color:red;
		height:40px;
		color:white;
		margin-top:-2px;
		padding-top:10px;
		box-sizing:border-box;
		font-size:18px;
	}
	.invalid{
		box-shadow: 0px 0px 6px red;
	}
	</style>
	<meta charset="utf-8"/>
</head>
<body ng-app="minhaCalculadoraDeHoras" ng-controller="CalculadoraDeHora">
	<div class="container-box">
		<div class="container">
			<div class="div-box-header" style="">
				<h3 style="padding: 12px 0px 0px;">Calculadora de Hora de Saida</h3>
			</div>
			<div class="error">
				<span>Informe as horas necessarias</span>
			</div>
			<div class="div-box-hora-entrada">
				<input id="horasParaTrabalhar" class="input-box required" type="text" placeholder="Horas a trabalhar" ng-model="horasParaTrabalharAux"/><br>
				<input id="horaDeEntrada" class="input-box required" type="text" placeholder="Hora de Entrada" ng-model="horaDeEntradaAux"/><br>
			</div>
			<div class="div-box">
				<input id="horaDeSaidaAlmoco" class="input-box" type="text" placeholder="Hora de Saida p/ Almoco" ng-model="horaDeSaidaAlmocoAux"/><br>
				<input id="horaDeChegadaAlmoco" class="input-box" type="text" placeholder="Hora de Chegada do Almoco" ng-model="horaDeChegadaAlmocoAux"/><br>
			</div>
			<div class="div-box-button">
				<button id="CalcularHora" class="button-box" ng-click="CalcularHora()">Calcular</button>
			</div>
			<div class="div-box-footer" style="padding: 0px 0px 10px">
				<h3 class=" display-none" style="margin-top: 10px;">Hora de Saida Prevista:</h3>
				<h1 id="HoraDeSaidaPrevista" class="h1-box display-none">{{tempoPrevistoDeSaida}}</h1>
			</div>
		</div>
	</div>
</body>
</html>